<html>
  <head>
    <meta charset="UTF-8" >
    <title>UNET example with p5.js</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
    <script src="https://unpkg.com/ml5@0.4.3/dist/ml5.min.js" type="text/javascript"></script>
  </head>

  <body>
    <h1>UNET example using p5.js</h1>
    <img src = "banana.JPG">
    <script>
let video;
let flippedVideo;
let uNet;
let segmentationImage;

// load uNet model
function preload() {
  uNet = ml5.uNet('face');
}

function setup() {
  createCanvas(320, 240);

  // load up your video
  video = createCapture(VIDEO);
  video.size(width, height);
  video.hide(); // Hide the video element, and just show the canvas

  // Start with a blank image
  // segmentationImage = createImage(width, height);
  flippedVideo = ml5.flipImage(video)

  // initial segmentation
  uNet.segment(flippedVideo, gotResult);
}

function gotResult(error, result) {
  // if there's an error return it
  if (error) {
    console.error(error);
    return;
  }
  // set the result to the global segmentation variable
  segmentationImage = result.backgroundMask;

  // Continue asking for a segmentation image
  flippedVideo = ml5.flipImage(video)
  uNet.segment(flippedVideo, gotResult);
}

function draw() {
  background(0)
  if(segmentationImage){
    image(segmentationImage, 0, 0, width, height);
  }
  
}
      </script>
  </body>
</html>
