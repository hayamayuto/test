let video;
let flippedVideo;
let uNet;
let segmentationImage;

// load uNet model
function preload() {
  uNet = ml5.uNet('face');
}

function setup() {
  createCanvas(320, 240);

  // load up your video
  video = createCapture(VIDEO);
  video.size(width, height);
  video.hide(); // Hide the video element, and just show the canvas

  // Start with a blank image
  // segmentationImage = createImage(width, height);
  flippedVideo = ml5.flipImage(video)

  // initial segmentation
  uNet.segment(flippedVideo, gotResult);
}

function gotResult(error, result) {
  // if there's an error return it
  if (error) {
    console.error(error);
    return;
  }
  // set the result to the global segmentation variable
  segmentationImage = result.backgroundMask;

  // Continue asking for a segmentation image
  flippedVideo = ml5.flipImage(video)
  uNet.segment(flippedVideo, gotResult);
}

function draw() {
  background(0)
  if(segmentationImage){
    image(segmentationImage, 0, 0, width, height);
  }
  
}
